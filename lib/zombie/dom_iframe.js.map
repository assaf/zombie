{"version":3,"sources":["zombie/dom_iframe.js"],"names":[],"mappings":"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","file":"zombie/dom_iframe.js","sourcesContent":["// Support for iframes.\n\n\nconst createHistory = require('./history');\nconst DOM           = require('./dom');\n\n\n// Support for iframes that load content when you set the src attribute.\nconst frameInit = DOM.HTMLFrameElement._init;\nDOM.HTMLFrameElement._init = function() {\n  frameInit.call(this);\n  this.removeEventListener('DOMNodeInsertedIntoDocument', this._initInsertListener);\n\n  const iframe        = this;\n  const parentWindow  = iframe.ownerDocument.parentWindow;\n  var contentWindow   = null;\n\n  Object.defineProperties(iframe, {\n    contentWindow: {\n      get() {\n        return contentWindow || createWindow();\n      }\n    },\n    contentDocument: {\n      get() {\n        return (contentWindow || createWindow()).document;\n      }\n    }\n  });\n\n\n  // URL created on the fly, or when src attribute set\n  function createWindow() {\n    // Need to bypass JSDOM's window/document creation and use ours\n    const open = createHistory(parentWindow.browser, function(active) {\n      // Change the focus from window to active.\n      contentWindow = active;\n    });\n    contentWindow = open({ name: iframe.name, parent: parentWindow, referrer: parentWindow.location.href });\n    return contentWindow;\n  }\n};\n\n\n\n// This is also necessary to prevent JSDOM from messing with window/document\nDOM.HTMLFrameElement.prototype.setAttribute = function(name, value) {\n  DOM.HTMLElement.prototype.setAttribute.call(this, name, value);\n};\n\nDOM.HTMLFrameElement.prototype._attrModified = function(name, value, oldValue) {\n  if (name === 'src' && value) {\n\n    const iframe = this;\n    const url    = DOM.resourceLoader.resolve(iframe.ownerDocument, value);\n    DOM.HTMLElement.prototype._attrModified.call(this, name, url, oldValue);\n\n    // Don't load IFrame twice\n    if (iframe.contentWindow.location.href === url)\n      return;\n\n    const ownerDocument = iframe.ownerDocument;\n\n    // Point IFrame at new location and wait for it to load\n    iframe.contentWindow.location = url\n    // IFrame will load in a different window\n    iframe.contentWindow.addEventListener('load', onload)\n\n    function onload() {\n      iframe.contentWindow.removeEventListener('load', onload);\n      const event = ownerDocument.createEvent('HTMLEvents');\n      event.initEvent('load', false, false);\n      iframe.dispatchEvent(event);\n    }\n\n  } else if (name === 'name') {\n\n    // Should be able to access parent.frames[name] -> this\n    const windowName        = value;\n    const { parentWindow }  = this.ownerDocument;\n    const { contentWindow } = this;\n    contentWindow.name = windowName;\n    delete parentWindow[oldValue];\n    parentWindow.__defineGetter__(windowName, ()=> this.contentWindow);\n\n  } else {\n    DOM.HTMLFrameElement.prototype._attrModified.call(this, name, value, oldValue);\n  }\n\n};\n"],"sourceRoot":"/source/"}